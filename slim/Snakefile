import itertools
import numpy as np
np.random.seed(1)

SLIM = "/home/vsb/src/SLiM_build/slim "
# SLIM = 'slim '
DATADIR = "../data/slim_sims/"

## Parameters
reps = range(20)

ouputs = ["log.tsv", "treeseq.tree"]

## ===== Non-WF =====
# polygenic_nonwf_rep0_Vs1_fitfuncoptimashift_optimasdNA_optima_shift0.5_K500_alpha0.01_muT1e-08_muN0_rbp1e-08_log.tsv
nonwf_params = ('rep', 'Vs', 'fitfunc', 'optimasd', 'K', 'alpha', 'muT', 'muN', 'rbp')

param_str = [v + '{' + v + '}' for v in nonwf_params]
nonwf_pattern = 'polygenic_nonwf/polygenic_nonwf_' + '_'.join(param_str) + '_{output}'

# params for optima shift
Vs = [1]
K = [100, 1000]
alpha = [0.01]
fitfunc = ['optimashift']
muN = [0]
muT = [1e-8]
optimasd = [1, 0.5]
rbp = [1e-8]

nonwf_results = expand(DATADIR + nonwf_pattern,
                       rep = reps, K=K, Vs=Vs, alpha=alpha,
                       fitfunc=fitfunc, muN=muN, muT=muT,
                       optimasd=optimasd,
                       rbp=rbp, output=ouputs)

rule nonwf_all:
  input:
    nonwf_results

rule nonwf:
  input:
    "polygenic_nonwf.slim"
  output:
    DATADIR + nonwf_pattern.replace("{output}", "log.tsv"),
    DATADIR + nonwf_pattern.replace("{output}", "treeseq.tree")
  shell:
    """
    mkdir -p {DATADIR}/nonwf/

    # the output files are automatically generated from the SLiM script
    {SLIM} -d K={wildcards.K} \
     -d Vs={wildcards.Vs} -d rep={wildcards.rep} \
     -d alpha={wildcards.alpha} -d "fitfunc='{wildcards.fitfunc}'" -d muT={wildcards.muT} \
     -d muN={wildcards.muN} \
     -d optimasd={wildcards.optimasd} -d rbp={wildcards.rbp} {input}
    """



## ===== Setup =====

rule all:
	input:
		nonwf_results

